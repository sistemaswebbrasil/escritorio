import{_ as E,a as $}from"./avatar_assistant-N5R35sIJ.js";import{d as D,ae as K,r as v,f as g,x as U,h as I,o as c,a as p,l as o,j as m,i as N,w as l,F as x,D as z,b as a,n as k,V as b,e as C,N as P,a0 as j,E as M,t as F,J as G,K as O,_ as R}from"./index-peTGnuZv.js";import{_ as q}from"./AnimationBot2.vue_vue_type_script_setup_true_lang-vWbvQB-y.js";import{r as J,c as L}from"./aiUtils-GRLGcJBd.js";import{W}from"./style-HJPgcar4.js";import{s as H}from"./common-k2UJY29s.js";import{u as Q}from"./chatGPTStore-Gx5Pozs7.js";import{_ as X}from"./ApiKeyDialog.vue_vue_type_script_setup_true_lang-FWpCo1dN.js";import{V as Y}from"./VTooltip-AgINamvM.js";import{V as Z}from"./VTextarea-d1cJikVS.js";import"./VSelect-lCOcwFFJ.js";import"./VCheckboxBtn-p360aezY.js";import"./VChip-q1dYm6WX.js";import"./VDialog-SWh3jXDF.js";const y=u=>(G("data-v-b81a92df"),u=u(),O(),u),ee={class:"chat-bot"},te={class:"messsage-area"},se={key:0},ae={class:"pa-5 user-message"},oe={class:"message align-center text-pre-wrap"},ne=y(()=>o("img",{src:E,alt:"alt"},null,-1)),re={key:1},le={class:"pa-5 assitant-message"},ie={class:"message"},ce=y(()=>o("img",{src:$,alt:"alt"},null,-1)),de={key:1,class:"no-message-container"},pe=y(()=>o("h1",{class:"text-h4 text-md-h2 text-blue-lighten-1 font-weight-bold"}," Ask Me Any Thing ",-1)),me={class:"input-area"},ue=D({__name:"ChatBotV2",setup(u){const _=K(),d=Q(),i=v(""),V=g(()=>[{content:d.propmpt,role:"system"}]),n=v([]),S=g(()=>{if(n.value.length<=10)return[...V.value,...n.value];{const e=n.value.slice(-10);return[...V.value,...e]}}),w=async()=>{i.value&&(n.value.push({content:i.value,role:"user"}),i.value="",await B())},B=async()=>{var t;const e=d.proxyUrl?d.proxyUrl:"https://openai.wndbac.cn";try{const r=await fetch(`${e}/v1/chat/completions`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${d.getApiKey}`},method:"POST",body:JSON.stringify({messages:S.value,model:d.model,stream:!0})});if(!r.ok){const h=await r.json();_.showErrorMessage(h.error.message);return}const s=(t=r.body)==null?void 0:t.getReader();s||_.showErrorMessage("Cannot read the stream."),n.value.push({content:"",role:"assistant"}),J(s,n)}catch(r){_.showErrorMessage(r.message)}};U(()=>n.value,e=>{e&&H(document.querySelector(".message-container"))},{deep:!0});const T=g(()=>{const e=n.value.slice(),t=e[e.length-1],r={...t,content:L(t.content)};return e[e.length-1]=r,e}),A=e=>{e.key==="Enter"&&(e.altKey||e.shiftKey)?(e.preventDefault(),i.value+=`
`):e.key==="Enter"&&(e.preventDefault(),w())},f=v(1);return(e,t)=>{const r=I("perfect-scrollbar");return c(),p("div",ee,[o("div",te,[m(n).length>0?(c(),N(r,{key:0,class:"message-container"},{default:l(()=>[(c(!0),p(x,null,z(m(T),s=>(c(),p(x,null,[s.role==="user"?(c(),p("div",se,[o("div",ae,[o("div",oe,[a(M,{class:"mr-4 mr-lg-8"},{default:l(()=>[ne]),_:1}),o("span",null,F(s.content),1)])])])):(c(),p("div",re,[o("div",le,[o("div",ie,[a(M,{class:"mr-4 mr-lg-8"},{default:l(()=>[ce]),_:1}),a(m(W),{modelValue:s.content,"onUpdate:modelValue":h=>s.content=h,previewOnly:""},null,8,["modelValue","onUpdate:modelValue"])])])]))],64))),256))]),_:1})):(c(),p("div",de,[pe,a(q,{size:300})]))]),o("div",me,[a(j,{elevation:"0",class:"input-panel d-flex align-end pa-1","max-width":"1200",color:"transparent"},{default:l(()=>[a(k,{class:"mb-1",variant:"elevated",icon:"",onClick:t[0]||(t[0]=s=>m(d).configDialog=!0)},{default:l(()=>[a(b,{size:"30",class:"text-primary"},{default:l(()=>[C("mdi-cog-outline")]),_:1}),a(Y,{activator:"parent",location:"top",text:"ChatGPT Config"})]),_:1}),a(Z,{class:"mx-2",color:"primary",type:"text",clearable:"",variant:"solo",ref:"input",modelValue:m(i),"onUpdate:modelValue":t[1]||(t[1]=s=>P(i)?i.value=s:null),placeholder:"Ask Me Anything","hide-details":"",onKeydown:A,"no-resize":"",rows:m(f),onFocus:t[2]||(t[2]=s=>f.value=12),onBlur:t[3]||(t[3]=s=>f.value=1)},null,8,["modelValue","rows"]),a(k,{class:"mb-1",color:"primary",variant:"elevated",icon:""},{default:l(()=>[a(b,{onClick:w},{default:l(()=>[C("mdi-send")]),_:1})]),_:1})]),_:1}),a(X)])])}}}),Be=R(ue,[["__scopeId","data-v-b81a92df"]]);export{Be as default};
